# Toggle Features Documentation

## Overview

cmdk now supports two independent toggle features that work seamlessly together:

### **Ctrl+T: Environment File Visibility**
- **State File**: `/tmp/cmdk_env_toggle_${USER}`
- **Default**: OFF (hides `.env`, `.gitignore`, etc.)
- **When ON**: Shows files that would normally be gitignored
- **Use Case**: Quick access to configuration files when needed

### **Ctrl+G: Git Filter Toggle**
- **State File**: `/tmp/cmdk_git_toggle_${USER}`
- **Default**: OFF (shows all files)
- **When ON**: Shows only git-changed files (modified, staged, untracked)
- **Use Case**: Focus on work-in-progress files
- **Fallback**: Returns to normal file list if not in a git repository

## How They Work Together

The toggles are **independent** and can be combined:

| Ctrl+T | Ctrl+G | Result |
|--------|--------|--------|
| OFF    | OFF    | All files (excluding gitignored by default) |
| ON     | OFF    | All files + gitignored files |
| OFF    | ON     | Git-changed files only |
| ON     | ON     | Git-changed files + any .env/.gitignored among them |

## Implementation Details

### State Management
- Each toggle maintains its own persistent state file in `/tmp/`
- State persists across multiple cmdk invocations during a session
- Automatically cleaned up when cmdk exits

### Script Architecture
```
cmdk-core.sh
  └── Uses: reload-files.sh
      ├── Checks: actions/toggle-state.sh (Ctrl+T)
      ├── Checks: actions/git-toggle-state.sh (Ctrl+G)
      ├── If Ctrl+G ON → runs: git-files.sh
      └── If Ctrl+G OFF → runs: reload-with-toggle.sh
          └── Respects: actions/toggle-state.sh (Ctrl+T)
```

### Error Handling
- If not in a git repository, Ctrl+G gracefully falls back to normal file list
- Both toggles fail silently and continue normal operation
- No breaking errors or messages to disrupt user experience

## Testing the Toggles

```bash
# Test Ctrl+T (env visibility)
bash actions/toggle-state.sh init off
bash reload-files.sh -o | grep -i env  # Should NOT show .env

bash actions/toggle-state.sh init on
bash reload-files.sh -o | grep -i env  # Should show .env

# Test Ctrl+G (git filter)
bash actions/git-toggle-state.sh init off
bash reload-files.sh -o | head -10    # Shows all files

bash actions/git-toggle-state.sh init on
bash reload-files.sh -o               # Shows only git-changed files
```

## Known Limitations
- Ctrl+G only works in git repositories (gracefully falls back)
- State files are per-user, not per-repository
- Toggles reset at end of each cmdk invocation
